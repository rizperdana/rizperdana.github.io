<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rizki Perdana - Software Engineer</title>
    <style>
        :root {
            --bg: #ffffff;
            --fg: #000000;
            --accent: #ff3e00;
            --accent-vivid: #2563eb;
            --border: 2px solid #000000;
            --shadow: 4px 4px 0px 0px #000000;
            --shadow-small: 2px 2px 0px 0px #000000;
        }

        body.dark {
            --bg: #1a1a1a;
            --fg: #e0e0e0;
            --accent: #ff3e00;
            --accent-vivid: #3b82f6;
            --border: 2px solid #ffffff;
            --shadow: 4px 4px 0px 0px #ffffff;
            --shadow-small: 2px 2px 0px 0px #ffffff;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace;
            line-height: 1.5;
            color: var(--fg);
            background: var(--bg);
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            font-size: 16px;
            transition: background-color 0.1s, color 0.1s;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg);
            color: var(--fg);
            border: var(--border);
            padding: 0.5em 1em;
            font-weight: bold;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-small);
        }

        .theme-toggle:hover {
            background: var(--accent);
            color: #fff;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px 0px var(--accent);
        }

        h1 {
            font-size: clamp(2.5rem, 8vw, 4rem);
            margin: 0 0 0.5em 0;
            line-height: 1.2;
            text-transform: uppercase;
            color: var(--fg);
            border-bottom: 3px solid var(--accent);
            padding-bottom: 0.2em;
        }

        h2 {
            font-size: 1.8em;
            margin: 2em 0 1em 0;
            text-transform: uppercase;
            color: var(--accent);
            border-left: 4px solid var(--accent);
            padding-left: 0.5em;
        }

        h3 {
            font-size: 1.4em;
            margin: 1.5em 0 0.5em 0;
            text-decoration: underline;
            text-decoration-thickness: 3px;
        }

        p {
            margin: 1em 0;
        }

        a {
            color: inherit;
            text-decoration: none;
            background: linear-gradient(0deg, var(--accent) 0%, var(--accent) 100%);
            background-size: 100% 3px;
            background-repeat: no-repeat;
            background-position: 0 95%;
            font-weight: bold;
        }

        a:hover {
            background-size: 100% 100%;
            color: #fff;
        }

        .subtitle {
            font-size: 1.5em;
            font-weight: bold;
            margin: 1em 0;
            border-left: 10px solid var(--accent);
            padding-left: 15px;
        }

        .contact {
            margin: 2em 0;
            display: flex;
            flex-wrap: wrap;
            gap: 1em;
        }

        .contact-item {
            background: var(--bg);
            border: var(--border);
            padding: 0.5em 1em;
            box-shadow: var(--shadow-small);
        }

        .project, .job {
            margin: 2em 0;
            padding: 1.5em;
            border: var(--border);
            box-shadow: var(--shadow);
            background: var(--bg);
            transition: all 0.2s ease;
        }

        .project:hover, .job:hover {
            box-shadow: 6px 6px 0px 0px var(--accent);
            border-color: var(--accent);
        }

        .tech-stack {
            margin-top: 1em;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5em;
        }

        .tech-tag {
            background: transparent;
            color: var(--fg);
            padding: 0.2em 0.6em;
            font-size: 0.85em;
            font-weight: bold;
            border: 1px solid var(--fg);
        }

        .period {
            display: inline-block;
            background: var(--accent);
            color: #fff;
            padding: 0.2em 0.5em;
            margin-bottom: 1em;
            font-weight: bold;
        }

        button:not(.theme-toggle) {
            background: var(--bg);
            color: var(--fg);
            border: var(--border);
            padding: 0.8em 1.5em;
            font-size: 1em;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: var(--shadow);
            margin: 2em 0;
            display: inline-block;
            transition: all 0.2s ease;
        }

        button:not(.theme-toggle):hover {
            background: var(--accent);
            color: #fff;
            box-shadow: 6px 6px 0px 0px var(--accent);
            transform: translate(-2px, -2px);
        }

        hr {
            border: none;
            height: 2px;
            background: var(--fg);
            margin: 3em 0;
            opacity: 0.3;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li::before {
            content: "> ";
            font-weight: bold;
            color: var(--accent);
        }

        .skill-category {
            margin: 1.5em 0;
            padding-bottom: 1em;
            border-bottom: 2px dashed var(--fg);
        }

        .loading, .error {
            font-weight: bold;
            text-transform: uppercase;
            animation: blink 1s step-end infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        /* Responsive grid for skills */
        #skills-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1em;
        }

        @media (max-width: 600px) {
            h1 { font-size: 2.5rem; }
            body { padding: 20px 10px; }
            .project, .job { box-shadow: 4px 4px 0px 0px var(--fg); }
        }
    </style>
</head>
<body class="dark">
    <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è Light</button>

    <!-- HOME SECTION -->
    <header style="margin-bottom: 3em;">
        <h1 id="name">Loading...</h1>
        <div id="title" class="subtitle"></div>
        <p id="summary" style="font-size: 1.1em; border-left: 4px solid var(--accent); padding-left: 1em;"></p>
    </header>

    <div id="contacts" class="contact"></div>

    <div style="margin: 2em 0;">
        <button onclick="downloadCV()">Download CV as PDF</button>
    </div>

    <hr>

    <!-- PROJECTS SECTION -->
    <h2>Projects</h2>
    <div id="projects-container" class="projects-grid">
        <p class="loading">Loading projects...</p>
    </div>

    <style>
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5em;
            margin-top: 1em;
        }
    </style>

    <hr>

    <!-- CV SECTION -->
    <h2>Experience</h2>
    <div id="experience-container">
        <p class="loading">Loading experience...</p>
    </div>

    <h2>Education</h2>
    <div id="education-container">
        <p class="loading">Loading education...</p>
    </div>

    <h2>Skills</h2>
    <div id="skills-container">
        <p class="loading">Loading skills...</p>
    </div>

    <h2>Languages</h2>
    <div id="languages-container">
        <p class="loading">Loading languages...</p>
    </div>

    <hr>

    <footer style="text-align: center; margin-top: 3em; padding-top: 2em; border-top: 2px dashed var(--fg);">
        <p style="font-size: 0.9em; opacity: 0.7;">
            SYSTEM_VERSION: <span id="version">1.0.0</span> |
            LAST_UPDATED: <span id="last-updated">Loading...</span>
        </p>
        <p style="font-size: 0.8em; margin-top: 1em;">
            BUILT_WITH: HTML, CSS, JS | NO_FRAMEWORKS
        </p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        let profileData = null;
        let projectsData = null;

        // Theme toggle
        function toggleTheme() {
            const body = document.body;
            const button = document.querySelector('.theme-toggle');

            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                button.textContent = 'üåô Dark';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark');
                button.textContent = '‚òÄÔ∏è Light';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const body = document.body;
            const button = document.querySelector('.theme-toggle');

            // Default to dark mode if no preference saved
            if (savedTheme === 'light') {
                body.classList.remove('dark');
                button.textContent = 'üåô Dark';
            } else {
                body.classList.add('dark');
                button.textContent = '‚òÄÔ∏è Light';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load data functions

        async function loadData() {
            try {
                const paths = [
                    { profile: './profile.json', projects: './projects.json' },
                    { profile: 'profile.json', projects: 'projects.json' },
                    { profile: '/profile.json', projects: '/projects.json' }
                ];

                let loaded = false;
                let lastError = null;

                for (const path of paths) {
                    try {
                        const [profileRes, projectsRes] = await Promise.all([
                            fetch(path.profile),
                            fetch(path.projects)
                        ]);

                        if (profileRes.ok && projectsRes.ok) {
                            const profileJson = await profileRes.json();
                            const projectsJson = await projectsRes.json();

                            if (profileJson && profileJson.name && projectsJson && projectsJson.projects) {
                                profileData = profileJson;
                                projectsData = projectsJson;
                                loaded = true;
                                break;
                            }
                        }
                    } catch (e) {
                        lastError = e;
                        continue;
                    }
                }

                if (!loaded) {
                    throw new Error(`Failed to load JSON files. Last error: ${lastError?.message || 'Unknown error'}`);
                }

                loadHome();
                loadProjects();
                loadCV();
            } catch (error) {
                console.error('Error loading data:', error);
                showError(`Failed to load data: ${error.message}`);
            }
        }

        function showError(message) {
            document.getElementById('name').textContent = 'Error Loading Data';
            document.getElementById('title').textContent = '';
            document.getElementById('summary').textContent = message;
            document.getElementById('contacts').innerHTML = '';

            document.querySelectorAll('.loading').forEach(el => {
                el.innerHTML = `<p class="error">${message}</p>`;
            });
        }

        function loadHome() {
            if (!profileData) return;

            document.getElementById('name').textContent = profileData.name || '';
            document.getElementById('title').textContent = profileData.title || '';
            document.getElementById('summary').textContent = profileData.summary || '';

            if (profileData.contacts && Array.isArray(profileData.contacts)) {
                const contactsHtml = profileData.contacts.map(contact => {
                    if (contact.includes('@')) {
                        return `<span class="contact-item">üìß <a href="mailto:${contact}">${contact}</a></span>`;
                    } else if (contact.includes('linkedin')) {
                        return `<span class="contact-item">üîó <a href="${contact}" target="_blank">LinkedIn</a></span>`;
                    } else if (contact.includes('+')) {
                        return `<span class="contact-item">üì± ${contact}</span>`;
                    } else {
                        return `<span class="contact-item">üìç ${contact}</span>`;
                    }
                }).join('');

                document.getElementById('contacts').innerHTML = contactsHtml;
            }
        }

        function loadProjects() {
            const container = document.getElementById('projects-container');

            if (!projectsData || !projectsData.projects || projectsData.projects.length === 0) {
                container.innerHTML = '<p>No projects available yet.</p>';
                return;
            }

            container.innerHTML = projectsData.projects.map(project => `
                <div class="project">
                    <h3>${project.title || 'Untitled'}</h3>
                    <p>${project.description || ''}</p>
                    <div class="tech-stack">
                        ${(project.technologies || []).map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
                    </div>
                    ${project.url ? `<a href="${project.url}" target="_blank">View Project ‚Üí</a>` : ''}
                    ${project.status ? `<span class="period" style="margin-left: 0.5em;">${project.status}</span>` : ''}
                </div>
            `).join('');
        }

        function loadCV() {
            if (!profileData) return;

            // Experience
            const expContainer = document.getElementById('experience-container');
            if (profileData.experience && Array.isArray(profileData.experience)) {
                expContainer.innerHTML = profileData.experience.map(exp => `
                    <div class="job">
                        <div class="job-header">
                            <div>
                                <h3>${exp.title || ''}</h3>
                                <span style="font-weight: bold;">@ ${exp.company || ''}</span>
                            </div>
                            <div class="period">${exp.location || ''} ‚Ä¢ ${exp.period || ''}</div>
                        </div>
                        <ul>
                            ${(exp.achievements || []).map(achievement => `<li>${achievement}</li>`).join('')}
                        </ul>
                    </div>
                `).join('');
            } else {
                expContainer.innerHTML = '<p>No experience data available</p>';
            }

            // Education
            const eduContainer = document.getElementById('education-container');
            if (profileData.education) {
                const edu = profileData.education;
                eduContainer.innerHTML = `
                    <div class="job">
                        <h3>${edu.degree || ''}</h3>
                        <p style="font-weight: bold;">${edu.institution || ''}</p>
                        <div class="period">${edu.period || ''}</div>
                    </div>
                `;
            } else {
                eduContainer.innerHTML = '<p>No education data available</p>';
            }

            // Skills
            const skillsContainer = document.getElementById('skills-container');
            if (profileData.skills && typeof profileData.skills === 'object') {
                skillsContainer.innerHTML = Object.entries(profileData.skills).map(([category, skills]) => `
                    <div class="skill-category" style="border: var(--border); padding: 1em; box-shadow: var(--shadow-small);">
                        <h4>${category}</h4>
                        <p>${skills}</p>
                    </div>
                `).join('');
            } else {
                skillsContainer.innerHTML = '<p>No skills data available</p>';
            }

            // Languages
            const langContainer = document.getElementById('languages-container');
            if (profileData.languages && Array.isArray(profileData.languages)) {
                langContainer.innerHTML = `<div style="display: flex; flex-wrap: wrap; gap: 1em;">
                    ${profileData.languages.map(lang => `
                        <div style="border: var(--border); padding: 0.5em 1em; box-shadow: var(--shadow-small);">
                            <strong>${lang.name || ''}:</strong> ${lang.level || ''}
                        </div>
                    `).join('')}
                </div>`;
            } else {
                langContainer.innerHTML = '<p>No language data available</p>';
            }
        }

        function downloadCV() {
            if (!profileData) {
                alert('CV data not loaded yet');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            
            // Configuration for ATS compliance
            const margin = 50;
            const pageWidth = doc.internal.pageSize.width;
            const maxWidth = pageWidth - (margin * 2);
            const lineHeight = 14;
            const sectionSpacing = 20;
            const subsectionSpacing = 12;
            
            let y = 60;
            
            // Helper function to check and handle page breaks
            function checkPageBreak(requiredSpace) {
                if (y + requiredSpace > doc.internal.pageSize.height - margin) {
                    doc.addPage();
                    y = margin;
                    return true;
                }
                return false;
            }
            
            // Helper function to calculate text height
            function getTextHeight(text, fontSize, width) {
                doc.setFontSize(fontSize);
                const lines = doc.splitTextToSize(text, width);
                return lines.length * lineHeight;
            }
            
            // Helper function to write wrapped text
            function writeWrapped(text, x, fontSize, width) {
                doc.setFontSize(fontSize);
                const lines = doc.splitTextToSize(text, width);
                doc.text(lines, x, y);
                y += lines.length * lineHeight;
                return lines.length;
            }
            
            // Header - Name (ATS-friendly, no special formatting)
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(24);
            doc.text(profileData.name.toUpperCase() || '', margin, y);
            y += 28;
            
            // Title
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            doc.text(profileData.title || '', margin, y);
            y += 18;
            
            // Contact Info - Single line, comma separated for ATS
            const contactLine = (profileData.contacts || []).join(' | ');
            doc.setFontSize(10);
            writeWrapped(contactLine, margin, 10, maxWidth);
            y += sectionSpacing;
            
            // Horizontal separator
            doc.setLineWidth(0.5);
            doc.line(margin, y, pageWidth - margin, y);
            y += sectionSpacing;
            
            // Summary Section
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('SUMMARY', margin, y);
            y += subsectionSpacing;
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            writeWrapped(profileData.summary || '', margin, 10, maxWidth);
            y += sectionSpacing;
            
            // Experience Section
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('PROFESSIONAL EXPERIENCE', margin, y);
            y += subsectionSpacing;
            
            if (profileData.experience && profileData.experience.length > 0) {
                profileData.experience.forEach((exp, index) => {
                    // Calculate space needed for this job entry
                    let entryHeight = 0;
                    entryHeight += lineHeight; // Title line
                    entryHeight += lineHeight; // Company line
                    entryHeight += lineHeight; // Date line
                    
                    // Calculate height for achievements
                    (exp.achievements || []).forEach(achievement => {
                        entryHeight += getTextHeight('\u2022 ' + achievement, 10, maxWidth - 10);
                    });
                    entryHeight += subsectionSpacing;
                    
                    // Check if we need a page break before this job entry
                    if (y + entryHeight > doc.internal.pageSize.height - margin) {
                        doc.addPage();
                        y = margin;
                    }
                    
                    // Job Title
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(11);
                    doc.text(exp.title || '', margin, y);
                    y += lineHeight;
                    
                    // Company and Location
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(10);
                    const companyText = `${exp.company} | ${exp.location || ''}`;
                    doc.text(companyText, margin, y);
                    y += lineHeight;
                    
                    // Period
                    doc.text(exp.period || '', margin, y);
                    y += lineHeight;
                    
                    // Achievements
                    doc.setFontSize(10);
                    (exp.achievements || []).forEach(achievement => {
                        // Check if we need page break for individual achievement
                        const achievementHeight = getTextHeight('\u2022 ' + achievement, 10, maxWidth - 10);
                        checkPageBreak(achievementHeight + lineHeight);
                        
                        writeWrapped('\u2022 ' + achievement, margin + 10, 10, maxWidth - 10);
                        y += 4; // Small extra spacing between bullets
                    });
                    
                    y += subsectionSpacing;
                });
            } else {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.text('No experience data available', margin, y);
                y += sectionSpacing;
            }
            
            // Education Section
            checkPageBreak(80);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('EDUCATION', margin, y);
            y += subsectionSpacing;
            
            if (profileData.education) {
                const edu = profileData.education;
                
                // Degree
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.text(edu.degree || '', margin, y);
                y += lineHeight;
                
                // Institution
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.text(edu.institution || '', margin, y);
                y += lineHeight;
                
                // Period
                doc.text(edu.period || '', margin, y);
                y += sectionSpacing;
            } else {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.text('No education data available', margin, y);
                y += sectionSpacing;
            }
            
            // Skills Section
            checkPageBreak(100);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('TECHNICAL SKILLS', margin, y);
            y += subsectionSpacing;
            
            if (profileData.skills && typeof profileData.skills === 'object') {
                Object.entries(profileData.skills).forEach(([category, skills]) => {
                    const categoryText = category + ': ';
                    const skillsText = skills;
                    
                    // Check available space
                    const totalHeight = getTextHeight(categoryText + skillsText, 10, maxWidth) + 6;
                    checkPageBreak(totalHeight);
                    
                    // Category name
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.text(categoryText, margin, y);
                    
                    // Skills - combined on same line if possible, otherwise wrapped
                    doc.setFont('helvetica', 'normal');
                    const categoryWidth = doc.getTextWidth(categoryText);
                    const skillsWidth = maxWidth - categoryWidth;
                    const skillLines = doc.splitTextToSize(skillsText, skillsWidth);
                    
                    if (skillLines.length === 1) {
                        // Fits on one line
                        doc.text(skillsText, margin + categoryWidth, y);
                        y += lineHeight;
                    } else {
                        // Multiple lines
                        doc.text(skillLines, margin, y + lineHeight);
                        y += (skillLines.length + 1) * lineHeight;
                    }
                    
                    y += 6; // Spacing between skill categories
                });
                
                y += sectionSpacing - 6;
            } else {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.text('No skills data available', margin, y);
                y += sectionSpacing;
            }
            
            // Languages Section
            checkPageBreak(50);
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.text('LANGUAGES', margin, y);
            y += subsectionSpacing;
            
            if (profileData.languages && profileData.languages.length > 0) {
                const languagesText = profileData.languages
                    .map(lang => `${lang.name}: ${lang.level}`)
                    .join(' | ');
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                writeWrapped(languagesText, margin, 10, maxWidth);
            } else {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.text('No language data available', margin, y);
            }
            
            // Save the PDF
            doc.save('Rizki_Perdana_CV.pdf');
        }

        // Set last updated date
        document.getElementById('last-updated').textContent = new Date().toLocaleDateString();

        initTheme();
        loadData();
    </script>
</body>
</html>
